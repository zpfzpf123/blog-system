# 博客详情页功能说明

## ✅ 已实现的功能

### 1. 智能目录功能

#### 自动提取目录
- 自动识别 Markdown 中的 H1、H2、H3 标题
- 生成层级化的目录列表
- 支持无限层级嵌套

#### 点击跳转
- 点击目录项平滑滚动到对应位置
- 自动调整偏移量，避免被顶部遮挡
- 跳转动画流畅自然

#### 滚动高亮跟随
- 页面滚动时，目录自动高亮当前阅读位置
- 实时更新活动目录项
- 视觉反馈明确

#### 层级样式
- **H1**：加粗、大字号、无缩进
- **H2**：中等字号、左缩进 24px
- **H3**：小字号、左缩进 36px、灰色

#### 交互效果
- 悬停：背景变色、蓝色文字
- 活动项：浅蓝背景、左侧蓝色边框、加粗

---

### 2. 代码块增强功能

#### 自动工具栏
每个代码块顶部自动添加工具栏，包含：
- **语言标签**：显示代码语言（如 JAVASCRIPT、PYTHON）
- **展开/收起按钮**：适用于超过 10 行的代码
- **复制按钮**：一键复制代码到剪贴板

#### 展开收起功能

**触发条件**：
- 代码超过 10 行时自动启用
- 默认状态：收起（显示前 300px）

**视觉效果**：
- 收起状态：底部渐变遮罩提示有更多内容
- 展开状态：显示完整代码
- 按钮文字动态切换："展开" ⇄ "收起"

**实现逻辑**：
```typescript
const lines = code.textContent?.split('\n').length || 0
const needCollapse = lines > 10

if (needCollapse) {
  pre.classList.add('code-collapsed')
  // 最大高度 300px，超出隐藏
  // 底部添加渐变遮罩
}
```

#### 复制功能

**操作流程**：
1. 点击"复制"按钮
2. 使用 `navigator.clipboard.writeText()` 复制代码
3. 按钮文字变为"✓ 已复制"，绿色高亮
4. 2 秒后自动恢复

**错误处理**：
- 复制失败显示"✗ 失败"
- 控制台输出错误信息

**核心代码**：
```typescript
copyBtn.addEventListener('click', async () => {
  const codeText = code.textContent || ''
  try {
    await navigator.clipboard.writeText(codeText)
    copyBtn.innerHTML = '<span>✓ 已复制</span>'
    copyBtn.classList.add('copied')
    
    setTimeout(() => {
      copyBtn.innerHTML = '<span>复制</span>'
      copyBtn.classList.remove('copied')
    }, 2000)
  } catch (err) {
    console.error('复制失败:', err)
  }
})
```

---

### 3. 样式设计

#### 代码工具栏样式
```css
/* 工具栏背景：浅灰色 */
background: #e8eaed;

/* 语言标签：紫色、大写、加粗 */
color: #667eea;
text-transform: uppercase;

/* 按钮：白色背景、灰色边框 */
background: white;
border: 1px solid #d0d4d9;

/* 悬停：蓝色 */
:hover {
  color: #409eff;
  border-color: #409eff;
  background: #ecf5ff;
}

/* 已复制：绿色 */
.copied {
  color: #67c23a;
  border-color: #67c23a;
}
```

#### 代码块收起效果
```css
.code-collapsed code {
  max-height: 300px;
  overflow: hidden;
}

/* 底部渐变遮罩 */
.code-collapsed code::after {
  content: '';
  position: absolute;
  bottom: 0;
  height: 60px;
  background: linear-gradient(to bottom, transparent, #f6f8fa);
}
```

---

## 使用示例

### 目录导航
```markdown
# 一级标题
## 二级标题
### 三级标题
```

**渲染效果**：
- 右侧目录自动生成
- 点击跳转到对应位置
- 滚动时高亮当前位置

### 代码块示例

````markdown
```javascript
function example() {
  console.log('Hello World')
  // ... 更多代码（超过10行会自动收起）
}
```
````

**渲染效果**：
```
┌─────────────────────────────────┐
│ JAVASCRIPT     [展开] [复制]    │ ← 工具栏
├─────────────────────────────────┤
│ function example() {            │
│   console.log('Hello World')    │
│   ...                           │
│ }                               │
│ ［渐变遮罩...］                 │ ← 收起状态
└─────────────────────────────────┘
```

---

## 技术特点

### 1. 性能优化
- DOM 操作在 `nextTick` 后执行
- 避免重复处理（检查是否已添加工具栏）
- 事件监听自动清理

### 2. 用户体验
- 平滑滚动动画
- 即时视觉反馈
- 清晰的状态提示

### 3. 兼容性
- 使用现代浏览器 API（Clipboard API）
- 优雅降级处理
- 错误提示友好

### 4. 可维护性
- 代码结构清晰
- 功能模块化
- 易于扩展

---

## 与其他页面对比

### ProjectDetail.vue
- 使用自定义目录生成
- 手动提取标题
- 自定义跳转逻辑

### BlogDetail.vue（本页面）
- **markdown-it** 自动生成 ID
- 更简洁的实现
- 更好的性能

**优势**：
- ✅ 代码量更少
- ✅ 维护成本低
- ✅ 功能更完善
- ✅ 体验更流畅

---

## 未来扩展

### 可添加的功能
1. **代码行号**：显示每行的行号
2. **代码高亮行**：支持指定高亮某几行
3. **代码主题切换**：支持多种配色主题
4. **全屏预览**：代码块全屏查看
5. **下载代码**：将代码保存为文件
6. **代码运行**：在线运行 JavaScript 代码

### 实现方式
所有功能都在 `enhanceCodeBlocks()` 函数中实现，易于扩展：

```typescript
const enhanceCodeBlocks = () => {
  // 现有功能...
  
  // 未来可添加：
  // - addLineNumbers()
  // - addFullscreenButton()
  // - addDownloadButton()
  // - addRunButton()
}
```

---

## 总结

本次重构完整实现了：
- ✅ **智能目录**：自动提取、点击跳转、滚动高亮
- ✅ **代码展开收起**：超过 10 行自动收起，可手动展开
- ✅ **代码复制**：一键复制，视觉反馈明确

所有功能都经过精心设计，注重用户体验和代码质量！
