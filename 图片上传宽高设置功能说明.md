# 图片上传宽高设置功能说明

## 功能概述

在博客的新建和编辑页面中，上传图片时现在可以手动设置图片的宽度和高度，如果不设置则使用图片的默认尺寸。系统会根据图片本身的宽高比例自动计算合适的默认尺寸。

## 功能特性

### 1. 智能默认尺寸

- **自动计算**: 根据图片原始尺寸自动计算合适的默认宽高
- **保持比例**: 默认宽度为600px，高度按图片比例自动计算
- **比例显示**: 显示图片的原始尺寸和宽高比例

### 2. 宽高设置

- **宽度单位**: 默认使用 `px` (像素)
- **高度单位**: 默认使用 `px` (像素)
- **可选单位**: 支持 `px`、`%`

### 3. 智能Markdown生成

- 如果设置了宽高，会生成HTML `<img>` 标签，包含样式属性
- 如果没有设置宽高，会生成标准的Markdown图片语法 `![alt](url)`

### 4. 自动比例计算

- **宽度变化**: 修改宽度时，高度自动按比例计算
- **高度变化**: 修改高度时，宽度自动按比例计算
- **单位同步**: 宽度和高度单位自动同步（px对应px，%对应%）
- 保持图片的原始宽高比例

### 5. 响应式显示

- 在博客详情页面，设置了宽高的图片会按照指定的尺寸显示
- 支持像素和百分比单位，确保在不同设备上都有良好的显示效果

### 6. 智能图片清理

- **自动清理**: 编辑博客后自动清理已删除的图片
- **存储优化**: 避免存储空间浪费，提高系统效率
- **安全删除**: 只删除确实不再使用的图片文件

## 使用方法

### 1. 上传图片

1. 在编辑器中粘贴图片或拖拽图片文件
2. 在弹出的对话框中：
   - 查看图片预览和原始信息
   - 输入自定义名称（可选）
   - 系统自动设置默认宽高（保持比例）
   - 手动调整宽度或高度（可选）
   - 选择相应的单位

### 2. 自动计算功能

- **修改宽度**: 输入宽度值后，高度会自动按比例计算
- **修改高度**: 输入高度值后，宽度会自动按比例计算
- **重置尺寸**: 点击"重置为默认尺寸"按钮恢复默认设置

### 3. 单位说明

- **px**: 像素，固定尺寸，推荐使用
- **%**: 相对于父元素的百分比

### 4. 示例

```
原始图片: 1920 × 1080 (比例: 1.78)
默认设置: 宽度 600px, 高度 337px (600/1.78 ≈ 337)

修改宽度为 800px → 高度自动变为 449px
修改高度为 400px → 宽度自动变为 712px
```

## 技术实现

### 1. 前端组件

- `PostCreate.vue`: 新建博客页面的图片上传功能
- `PostEdit.vue`: 编辑博客页面的图片上传功能
- 两个页面功能完全一致，代码结构清晰

### 2. 图片处理

- 使用HTML `<img>` 标签替代Markdown语法，以支持样式属性
- 在 `imageUtils.ts` 中添加了对HTML标签的处理逻辑
- 自动获取图片的 `naturalWidth` 和 `naturalHeight` 属性

### 3. 智能计算

- 根据图片原始尺寸计算宽高比例
- 实现宽度和高度之间的自动比例计算
- 支持像素和百分比单位的智能转换

### 4. 渲染支持

- 博客详情页面使用 `markdown-it` 渲染，支持HTML标签
- 图片样式会正确应用到显示的图片上

### 5. 图片清理机制

- **内容对比**: 对比编辑前后的内容，找出被删除的图片
- **URL提取**: 支持Markdown和HTML两种图片语法的URL提取
- **批量删除**: 调用后端API批量删除已删除的图片
- **错误处理**: 删除失败不影响文章更新，只记录日志

## 注意事项

1. **单位选择**: 建议根据实际需求选择合适的单位
   - 固定尺寸推荐使用 `px`
   - 响应式设计推荐使用 `%`

2. **性能考虑**: 设置过大的尺寸可能会影响页面性能，建议合理设置

3. **兼容性**: 生成的HTML标签在现代浏览器中都有良好的支持

4. **图片预览**: 支持常见图片格式（JPG、PNG、GIF、WebP等）

## 更新日志

- 新增图片上传时的宽高设置功能
- 支持像素和百分比单位选择
- 新增图片预览功能
- 新增自动计算默认宽高功能
- 新增智能比例计算功能
- 优化图片显示效果
- 保持向后兼容性
- 默认单位改为px，提供更直观的尺寸控制
